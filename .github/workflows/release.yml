name: Авто-релиз

on:
  push:
    tags:
      - 'v*'  # срабатывает на теги v1.0.0, v2.3.1 и т.д.

permissions:
  contents: write  # для создания релиза

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout кода
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # для CHANGELOG

      - name: Создать релиз
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh release create "${{ github.ref_name }}" \
            --repo="${{ github.repository }}" \
            --title="v${{ github.ref_name }}" \
            --generate-notes  # авто-генерация changelog из коммитов[web:67]

      # Опционально: сборка ZIP расширения
      - name: Упаковать расширение
        run: |
          zip -r extension-v${{ github.ref_name }}.zip . -x "*.git*" "node_modules/*"

      - name: Загрузить asset
        run: |
          gh release upload "${{ github.ref_name }}" extension-v${{ github.ref_name }}.zip --clobber
